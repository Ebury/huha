"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}require("core-js/modules/es6.array.find"),require("core-js/modules/es6.function.name"),require("core-js/modules/es6.object.assign");var _global=global,document=_global.document,IN_PROGRESS="In progress",COMPLETED="Completed",ABANDONED="Abandoned",DEFAULTS={trackOnGoogleAnalytics:!0,trackOnIntercom:!1},HuhaTask=function(){function s(t,e){_classCallCheck(this,s);var n=Object.assign(DEFAULTS,e);this.name=t,this.status=IN_PROGRESS,this.effort=0,this.errors=0,this.start=(new Date).getTime(),this.end=null,this.trackOnGoogleAnalytics=n.trackOnGoogleAnalytics,this.trackOnIntercom=n.trackOnIntercom}return _createClass(s,[{key:"addInteraction",value:function(){this.effort+=1}},{key:"addError",value:function(){this.errors+=1}},{key:"finish",value:function(t){this.status===IN_PROGRESS&&(this.end=(new Date).getTime(),this.status=t,this.track())}},{key:"complete",value:function(){this.finish(COMPLETED)}},{key:"abandon",value:function(){this.finish(ABANDONED)}},{key:"track",value:function(){this.trackOnGoogleAnalytics&&this.sendToGoogleAnalytics(),this.trackOnIntercom&&this.sendToIntercom()}},{key:"sendToGoogleAnalytics",value:function(){"undefined"!=typeof gtag?(gtag("event","timing_complete",{event_category:this.name,event_label:"Time on task",value:this.time,name:this.status}),gtag("event",this.status,{event_category:this.name,event_label:"Error",value:this.errors}),gtag("event",this.status,{event_category:this.name,event_label:"Effort",value:this.effort})):"undefined"!=typeof ga&&(ga("send","timing",this.name,this.status,this.time,"Time on task"),ga("send","event",this.name,this.status,"Error",this.errors),ga("send","event",this.name,this.status,"Effort",this.effort))}},{key:"sendToIntercom",value:function(){"undefined"!=typeof Intercom&&Intercom("trackEvent",this.name,{errors:this.errors,effort:this.effort,time:this.time,status:this.status})}},{key:"time",get:function(){var t=0;return this.end&&(t=this.end-this.start),t}}]),s}(),Huha=function(){function n(t){_classCallCheck(this,n),this.tasks=[];var e=Object.assign(DEFAULTS,t||{});this.trackOnGoogleAnalytics=e.trackOnGoogleAnalytics,this.trackOnIntercom=e.trackOnIntercom,this.setUpEvents()}return _createClass(n,[{key:"createTask",value:function(t){var e=this.getTask(t);void 0!==e&&e.abandon();var n=new HuhaTask(t,{trackOnGoogleAnalytics:this.trackOnGoogleAnalytics,trackOnIntercom:this.trackOnIntercom});return this.tasks.push(n),n}},{key:"getTask",value:function(e){return this.tasks.find(function(t){return t.name===e&&t.status===IN_PROGRESS})}},{key:"setUpEvents",value:function(){var n=this;global.addEventListener("beforeunload",function(){n.abandonInProgressTasks()});["click","focus","change"].forEach(function(e){document.querySelector("body").addEventListener(e,function(t){"huhaTask"in t.target.dataset&&n.registerEvent(e,t.target)},!0)})}},{key:"registerEvent",value:function(t,e){var n=e.dataset,s=n.huhaTask,a=n.huhaTrigger,r=n.huhaEvent;if(t===a)if("start"===r)this.createTask(s);else{var i=this.getTask(s);i&&("complete"===r?i.complete():"abandon"===r?i.abandon():"interaction"===r?i.addInteraction():"error"===r&&i.addError())}}},{key:"abandonInProgressTasks",value:function(){this.tasks.filter(function(t){return t.status===IN_PROGRESS}).forEach(function(t){return t.abandon()})}}]),n}();module.exports=Huha;
//# sourceMappingURL=huha.js.map
